<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Montreal Explorer Backend</title>
    <!-- Bootstrap CDN for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
        }
        .card {
            border: none;
            border-radius: 15px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background: linear-gradient(45deg, #2b5876, #4e4376);
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
        }
        .btn-primary:hover {
            background: linear-gradient(45deg, #4e4376, #2b5876);
            transform: translateY(-2px);
        }
        .blog-post {
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
        }
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
        .delay-5 { animation-delay: 0.5s; }
        .delay-6 { animation-delay: 0.6s; }
        .delay-7 { animation-delay: 0.7s; }
        .delay-8 { animation-delay: 0.8s; }
        .delay-9 { animation-delay: 0.9s; }
        .delay-10 { animation-delay: 1.0s; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .system-info-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .loading {
            position: relative;
            opacity: 0.7;
            pointer-events: none;
        }
        .loading::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-light">
    <div class="container my-5">
        <div class="text-center mb-5">
            <h1 class="display-4 fw-bold mb-3">Montreal Explorer Backend üó∫Ô∏è</h1>
            <p class="lead text-muted">Your Gateway to Montreal's Digital Services</p>
        </div>

        <!-- Time & Message -->
        <div class="card mb-4">
            <div class="card-body p-4">
                <div class="row">
                    <div class="col-md-6 border-end">
                        <div class="d-flex align-items-center mb-3">
                            <i class="fas fa-clock fa-2x text-primary me-3"></i>
                            <div>
                                <h5 class="card-title mb-1">Montreal Time</h5>
                                <p class="card-text h4 mb-0">{{ current_time }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-comment-dots fa-2x text-primary me-3"></i>
                            <div>
                                <h5 class="card-title mb-1">Welcome Message</h5>
                                <p class="card-text h5 mb-0 text-muted">{{ message }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Info -->
        <div class="card mb-4">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="card-title mb-0">
                        <i class="fas fa-server text-primary me-2"></i>
                        System Status
                    </h4>
                    <span class="badge bg-success">Online</span>
                </div>
                <div class="row g-4">
                    {% for key, value in system_info.items() %}
                        <div class="col-md-6">
                            <div class="system-info-item">
                                <i class="fas fa-{% if 'CPU' in key %}microchip{% elif 'Memory' in key %}memory{% elif 'Python' in key %}python{% elif 'Operating' in key %}desktop{% else %}clock{% endif %} text-primary"></i>
                                <div>
                                    <small class="text-muted d-block">{{ key }}</small>
                                    <strong>{{ value }}</strong>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Blog Posts -->
        <div class="card mb-4">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="card-title mb-0">
                        <i class="fas fa-blog text-primary me-2"></i>
                        Blog Posts
                    </h4>
                    <button class="btn btn-sm btn-outline-primary" onclick="window.location.href='#blogForm'">
                        <i class="fas fa-plus me-2"></i>New Post
                    </button>
                </div>
                <div id="posts">
                    {% if posts %}
                        {% for post in posts %}
                            <div class="blog-post mb-4 p-4 border rounded bg-white delay-{{ loop.index }}">
                                <h5 class="mb-3">
                                    <i class="fas fa-newspaper text-primary me-2"></i>
                                    {{ post.title }}
                                </h5>
                                <p class="mb-3">{{ post.content }}</p>
                                <div class="d-flex justify-content-between align-items-center text-muted">
                                    <span>
                                        <i class="fas fa-user-edit me-2"></i>
                                        {{ post.author }}
                                    </span>
                                    <span>
                                        <i class="fas fa-calendar-alt me-2"></i>
                                        {{ post.created_at.strftime("%Y-%m-%d %H:%M:%S") }}
                                    </span>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-newspaper fa-3x text-muted mb-3"></i>
                            <p class="lead">No blog posts yet. Create some below!</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Add New Blog Post Form -->
        <div class="card mb-4">
            <div class="card-body p-4">
                <div class="d-flex align-items-center mb-4">
                    <i class="fas fa-edit fa-2x text-primary me-3"></i>
                    <h4 class="card-title mb-0">Create New Blog Post</h4>
                </div>
                <form id="blogForm" class="needs-validation" novalidate>
                    <div class="mb-4">
                        <label for="title" class="form-label">
                            <i class="fas fa-heading me-2"></i>Title
                        </label>
                        <input type="text" id="title" class="form-control form-control-lg" required
                               placeholder="Enter post title">
                        <div class="invalid-feedback">Please provide a title.</div>
                    </div>
                    <div class="mb-4">
                        <label for="content" class="form-label">
                            <i class="fas fa-paragraph me-2"></i>Content
                        </label>
                        <textarea id="content" class="form-control" rows="6" required
                                  placeholder="Write your post content here..."></textarea>
                        <div class="invalid-feedback">Please provide content for your post.</div>
                    </div>
                    <div class="mb-4">
                        <label for="author" class="form-label">
                            <i class="fas fa-user me-2"></i>Author
                        </label>
                        <input type="text" id="author" class="form-control" required
                               placeholder="Your name">
                        <div class="invalid-feedback">Please provide an author name.</div>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-paper-plane me-2"></i>Publish Post
                        </button>
                    </div>
                </form>
                <div id="formMessage" class="mt-4"></div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-5 mb-3">
            <div class="mb-3">
                <i class="fas fa-heart text-danger"></i>
                Built with love in Montreal
            </div>
            <div class="text-muted">
                &copy; {{ current_time[:4] }} Montreal Explorer
                <span class="mx-2">|</span>
                <a href="https://github.com/drjoeycadieux/montrealexplorer-api" class="text-decoration-none" target="_blank">
                    <i class="fab fa-github me-1"></i>GitHub
                </a>
            </div>
        </footer>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JavaScript to handle form submission -->
    <script>
        // Form validation
        const form = document.getElementById('blogForm');
        const formMessage = document.getElementById('formMessage');
        const postsDiv = document.getElementById('posts');

        // Custom form validation
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!form.checkValidity()) {
                e.stopPropagation();
                form.classList.add('was-validated');
                return;
            }

            // Show loading state
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Publishing...';
            submitBtn.disabled = true;
            form.classList.add('loading');

            const data = {
                title: document.getElementById('title').value,
                content: document.getElementById('content').value,
                author: document.getElementById('author').value
            };

            try {
                const res = await fetch('/api/blog', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await res.json();

                if (res.ok) {
                    // Show success message with animation
                    formMessage.innerHTML = `
                        <div class="alert alert-success d-flex align-items-center" role="alert">
                            <i class="fas fa-check-circle me-2"></i>
                            <div>Post published successfully!</div>
                        </div>`;

                    // Add the new post to the posts list with animation
                    const postHTML = `
                        <div class="blog-post mb-4 p-4 border rounded bg-white delay-1">
                            <h5 class="mb-3">
                                <i class="fas fa-newspaper text-primary me-2"></i>
                                ${result.title}
                            </h5>
                            <p class="mb-3">${result.content}</p>
                            <div class="d-flex justify-content-between align-items-center text-muted">
                                <span>
                                    <i class="fas fa-user-edit me-2"></i>
                                    ${result.author}
                                </span>
                                <span>
                                    <i class="fas fa-calendar-alt me-2"></i>
                                    ${result.created_at}
                                </span>
                            </div>
                        </div>
                    `;

                    // If there's a "no posts" message, remove it
                    const noPostsMessage = postsDiv.querySelector('.text-center.py-5');
                    if (noPostsMessage) {
                        noPostsMessage.remove();
                    }

                    // Add new post with animation
                    postsDiv.insertAdjacentHTML('afterbegin', postHTML);

                    // Reset form
                    form.reset();
                    form.classList.remove('was-validated');

                    // Smooth scroll to the new post
                    const newPost = postsDiv.firstElementChild;
                    newPost.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    formMessage.innerHTML = `
                        <div class="alert alert-danger d-flex align-items-center" role="alert">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            <div>${result.error || 'Error creating post'}</div>
                        </div>`;
                }
            } catch (err) {
                formMessage.innerHTML = `
                    <div class="alert alert-danger d-flex align-items-center" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <div>Network error. Please try again.</div>
                    </div>`;
                console.error(err);
            } finally {
                // Reset button state
                submitBtn.innerHTML = originalBtnText;
                submitBtn.disabled = false;
                form.classList.remove('loading');

                // Auto-hide message after 5 seconds
                setTimeout(() => {
                    const alert = formMessage.querySelector('.alert');
                    if (alert) {
                        alert.style.transition = 'opacity 0.5s ease';
                        alert.style.opacity = '0';
                        setTimeout(() => {
                            formMessage.innerHTML = '';
                        }, 500);
                    }
                }, 5000);
            }
        });
    </script>
</body>
</html>
